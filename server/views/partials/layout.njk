{% extends "govuk/template.njk" %}

{% from "../macros/breadCrumb.njk" import breadCrumb %}
{% from "govuk/components/phase-banner/macro.njk" import govukPhaseBanner %}
{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "../macros/title-and-intro.njk" import titleAndIntro %}
{% from "../macros/status-details.njk" import statusDetails %}
{% from "../macros/pathway-subnav.njk" import subNav %}

{% block head %}
  <link href="/assets/stylesheets/application.css?{{ version }}" rel="stylesheet"/>
  <!--<![endif]-->
  <!-- [if lt IE 9]> <link href="/assets/stylesheets/application-ie8.css?{{ version }}" rel="stylesheet"/> <script
  src="/assets/js/html5shiv-3.7.3.min.js"></script> <![endif] --><script src="/assets/js/jquery.min.js"> </script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js" integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" nonce="{{ cspNonce }}" crossorigin="anonymous"></script>
  <link href="https://code.jquery.com/ui/1.12.1/themes/ui-lightness/jquery-ui.css" rel="stylesheet" nonce="{{ cspNonce }}" crossorigin>
{% endblock %}

{% block pageTitle %}{{pageTitle | default(applicationName)}}
{% endblock %}

{% block header %}
  {% include "./header.njk" %}

  <div class="govuk-width-container">
    {% set breadcrumbItems = [
      {
        text: "Digital Prison Services",
        href: dpsUrl
      },
      {
        text: "Prepare someone for release",
        href: '/'
      },
      {
        text: [prisonerData.personalDetails.lastName, ", ", prisonerData.personalDetails.firstName, " (", prisonerData.personalDetails.prisonerNumber, ")"] | join,
        href: '/prisoner-overview/?prisonerNumber=' + prisonerData.personalDetails.prisonerNumber if pathway !== 'Resettlement overview'
      },
      {
        text: pathway
      }
    ] %}

    {% set dynamicBreadcrumbs = [] %}
    {% for item in breadcrumbItems %}
      {% if pathway !== 'Resettlement overview' %}
        {% set _ = dynamicBreadcrumbs.push(item) %}
      {% else %}
        {% if loop.index !== 4 %}
          {% set _ = dynamicBreadcrumbs.push(item) %}
        {% endif %}
      {% endif %}
    {% endfor %}

    {{ breadCrumb(dynamicBreadcrumbs) }}

    {% include "../partials/profileHeader.njk" %}
    {% include "../partials/mainNav.njk" %}
  </div>
{% endblock %}
{% block bodyStart %}{% endblock %}

{% block bodyEnd %}
  {# Run JavaScript at end of the
    <body>, to avoid blocking the initial render. #}
  <script src="/assets/govuk/all.js"></script>
  <script src="/assets/govukFrontendInit.js"></script>
  <script src="/assets/moj/all.js"></script>
{% endblock %}