{% macro prisonersTable(prisoners) %}
  <table class="govuk-table" id="myTable">
    <thead class="govuk-table__head">
      <tr class="govuk-table__row">
        <th scope="col" class="govuk-table__header">Name</th>
        <th scope="col" class="govuk-table__header">Release</th>
        <th scope="col" class="govuk-table__header">Resettlement statuses</th>
        <th scope="col" class="govuk-table__header">Last updated</th>
      </tr>
    </thead>
    <tbody class="govuk-table__body">
      {% for prisoner in prisoners %}
        {{ prisonerRow(prisoner.firstName, prisoner.lastName, prisoner.prisonerNumber, prisoner.releaseDate, prisoner.releaseType, prisoner.status, prisoner.lastUpdatedDate) }}
      {% endfor %}
    </tbody>
  </table>
{% endmacro %}
{% macro prisonerRow(firstName, lastName, prisonerNumber, releaseDate, releaseType, statuses, lastUpdatedDate) %}
  <tr class="govuk-table__row">
    <td class="govuk-table__cell">
      <a href="/prisoner-overview/?prisonerId={{ prisonerNumber }}">{{ lastName }}, {{ firstName }}</a>
      <br/>
      <span class="govuk-body-s">
        {{ prisonerNumber }}
      </span>
    </td>
    <td class="govuk-table__cell">
      {{ releaseDate }} <br/>
      <span class="govuk-body-s">
        {{ releaseType }}
      </span>
    </td>
    {% set notStarted = 0 %}
    {% set inProgress = 0 %}
    {% set closed = 0 %}
    {% for status in statuses %}
      {% if status.status === 'Not Started' %}
        {% set notStarted = notStarted + 1 %}
      {% endif %}
      {% if status.status === 'In Progress' %}
        {% set inProgress = inProgress + 1 %}
      {% endif %}
      {% if status.status === 'Closed' %}
        {% set closed = closed + 1 %}
      {% endif %}
    {% endfor %}
    <td class="govuk-table__cell">
      <strong class="govuk-tag govuk-tag--red">
        <b>{{ notStarted }}</b>
        not started
      </strong>
      &nbsp;
      <strong class="govuk-tag govuk-tag--blue">
        <b>{{ inProgress }}</b>
        in progress
      </strong>
      &nbsp;
      <strong class="govuk-tag govuk-tag--green">
        <b>{{ closed }}</b>
        closed
      </strong>
      <br/>
      <details class="govuk-details govuk-body-s" data-module="govuk-details">
        <summary class="govuk-details__summary">
          <span class="govuk-details__summary-text">Show resettlement statuses</span>
        </summary>
        <div class="govuk-details__text">
          <table>
            <tbody>
              {% for pathway in statuses %}
                <tr>
                  <td>
                    <a href="/{{ pathway.pathway | replace(',', '') | replace(' ', '-') | lower }}/?prisonerId={{ prisonerNumber }}">{{ pathway.pathway }}</a>:
                  </td>
                  <td>
                    {% set tag_color %}
                      {% if pathway.status == 'Closed' %}
                        green
                      {% elif pathway.status == 'In Progress' %}
                        blue
                      {% elif pathway.status == 'Declined' %}
                        green
                      {% elif pathway.status == 'Not Started' %}
                        red
                      {% elif pathway.status == 'Incomplete' %}
                        green
                      {% elif pathway.status == 'Unrequired' %}
                        green
                      {% else %}
                        red
                      {% endif %}
                    {% endset %}
                    <strong class="govuk-tag govuk-tag--{{ tag_color|trim }}">{{ pathway.status }}</strong>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </details>
    </td>
    <td class="govuk-table__cell">
      {{ lastUpdatedDate }}
    </td>
  </tr>
{% endmacro %}